<!-- components/patient/medical-records/patient-medical-records.component.html -->
<div class="patient-medical-records">
  <!-- En-tête de section -->
  <div class="section-header">
    <div class="header-content">
      <h2><i class="fas fa-file-medical"></i> Mon dossier médical</h2>
      <p>Consultez et gérez vos documents médicaux</p>
    </div>
    <div class="header-actions">
      <button 
        class="btn-primary" 
        (click)="showAddForm = !showAddForm"
        [disabled]="isLoading"
      >
        <i class="fas fa-plus"></i>
        {{ showAddForm ? 'Annuler' : 'Ajouter un document' }}
      </button>
      <button 
        class="btn-secondary"
        (click)="exportRecords()"
        [disabled]="isLoading"
      >
        <i class="fas fa-download"></i> Exporter
      </button>
    </div>
  </div>

  <!-- Formulaire d'ajout -->
  <div class="add-record-section" *ngIf="showAddForm">
    <div class="record-form">
      <h3><i class="fas fa-file-medical-alt"></i> Ajouter un document médical</h3>
      
      <form (ngSubmit)="addMedicalRecord()" class="medical-form">
        <div class="form-row">
          <div class="form-group">
            <label for="date">Date du document *</label>
            <input 
              type="date" 
              id="date"
              [(ngModel)]="newRecord.date"
              name="date"
              required
              class="form-input"
              [max]="getToday()"
            >
          </div>
          
          <div class="form-group">
            <label for="type">Type de document *</label>
            <select 
              id="type"
              [(ngModel)]="newRecord.type"
              name="type"
              required
              class="form-select"
            >
              <option value="">Sélectionnez un type</option>
              <option *ngFor="let type of recordTypes" [value]="type">
                {{ type }}
              </option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label for="description">Description *</label>
          <textarea 
            id="description"
            [(ngModel)]="newRecord.description"
            name="description"
            required
            class="form-textarea"
            rows="4"
            placeholder="Description du document (diagnostic, résultats d'examens, prescriptions...)"
          ></textarea>
        </div>
        
        <div class="form-group">
          <label for="notes">Notes complémentaires (optionnel)</label>
          <textarea 
            id="notes"
            [(ngModel)]="newRecord.notes"
            name="notes"
            class="form-textarea"
            rows="3"
            placeholder="Informations supplémentaires..."
          ></textarea>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="cancelAddForm()">
            <i class="fas fa-times"></i> Annuler
          </button>
          <button type="submit" class="btn-primary" [disabled]="!isFormValid()">
            <i class="fas fa-save"></i> Enregistrer le document
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Filtres -->
  <div class="filters-section">
    <div class="filter-group">
      <label>Type:</label>
      <select [(ngModel)]="typeFilter" (change)="filterRecords()">
        <option value="all">Tous les types</option>
        <option *ngFor="let type of recordTypes" [value]="type">
          {{ type }}
        </option>
      </select>
    </div>
    
    <div class="filter-group">
      <label>Du:</label>
      <input 
        type="date" 
        [(ngModel)]="dateFromFilter"
        (change)="filterRecords()"
        title="Filtrer par date de début"
      >
    </div>
    
    <div class="filter-group">
      <label>Au:</label>
      <input 
        type="date" 
        [(ngModel)]="dateToFilter"
        (change)="filterRecords()"
        title="Filtrer par date de fin"
      >
    </div>
    
    <button class="btn-secondary btn-small" (click)="clearFilters()">
      <i class="fas fa-times"></i> Effacer filtres
    </button>
  </div>

  <!-- Statistiques rapides -->
  <div class="stats-summary">
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-file-medical"></i>
      </div>
      <div class="stat-content">
        <h4>{{ medicalRecords.length }}</h4>
        <p>Documents médicaux</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-user-md"></i>
      </div>
      <div class="stat-content">
        <h4>{{ getUniqueDoctorsCount() }}</h4>
        <p>Médecins différents</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-calendar"></i>
      </div>
      <div class="stat-content">
        <h4>{{ getLastRecordDate() | date:'yyyy' }}</h4>
        <p>Année du dernier document</p>
      </div>
    </div>
  </div>

  <!-- Liste des documents médicaux -->
  <div class="records-container">
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner"></div>
      <p>Chargement des documents médicaux...</p>
    </div>
    
    <div *ngIf="!isLoading && filteredRecords.length === 0" class="no-records">
      <div class="empty-state">
        <i class="fas fa-file-medical-alt"></i>
        <h4>Aucun document médical</h4>
        <p *ngIf="medicalRecords.length === 0">
          Vous n'avez pas encore de documents médicaux enregistrés.
        </p>
        <p *ngIf="medicalRecords.length > 0">
          Aucun document ne correspond à vos critères de recherche.
        </p>
        <button class="btn-primary" (click)="showAddForm = true">
          <i class="fas fa-plus"></i> Ajouter un document
        </button>
      </div>
    </div>
    
    <div *ngFor="let record of filteredRecords" class="record-card">
      <div class="record-header">
        <div class="record-type-badge" [class]="'type-' + record.type.toLowerCase()">
          <i [class]="getRecordTypeIcon(record.type)"></i>
          {{ getRecordType(record.type) }}
        </div>
        <span class="record-date">{{ record.date | date:'dd/MM/yyyy' }}</span>
      </div>
      
      <div class="record-content">
        <h4>{{ record.description | slice:0:100 }}{{ record.description.length > 100 ? '...' : '' }}</h4>
        
        <div *ngIf="record.notes" class="record-notes">
          <p><strong>Notes:</strong> {{ record.notes }}</p>
        </div>
        
        <div class="record-meta">
          <span><i class="fas fa-user-injured"></i> Patient ID: {{ record.patientId | slice:0:8 }}...</span>
          <span *ngIf="record.doctorId"><i class="fas fa-user-md"></i> Médecin ID: {{ record.doctorId | slice:0:8 }}...</span>
        </div>
      </div>
      
      <div class="record-actions">
        <button class="btn-secondary btn-small">
          <i class="fas fa-eye"></i> Voir détails
        </button>
        <button 
          class="btn-danger btn-small"
          (click)="deleteRecord(record.id)"
        >
          <i class="fas fa-trash"></i> Supprimer
        </button>
      </div>
    </div>
  </div>
</div>